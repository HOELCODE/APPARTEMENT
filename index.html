<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tableau Appartements</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f5f7fa;
        padding: 30px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        background-color: #fff;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
        vertical-align: middle;
    }

    th {
        background-color: #007BFF;
        color: white;
    }

    tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    input[type="checkbox"] {
        transform: scale(1.3);
        cursor: pointer;
    }

    td.comment {
        background-color: #fffbea;
        width: 300px;
        padding: 0;
    }

    td.comment:focus-within {
        background-color: #fff3c4;
    }

    .comment-container {
        overflow-x: auto;
        white-space: nowrap;
        width: 100%;
    }

    .editable {
        border: none;
        background: transparent;
        font-size: 1em;
        text-align: left;
        padding: 8px;
        min-width: 300px;
    }

    .editable:focus {
        outline: 1px solid #007BFF;
        background-color: #eef6ff;
    }

    .batiment-header {
        background-color: #e2e6ea;
        font-weight: bold;
        text-align: left;
    }

    .etage-header {
        background-color: #d9edf7;
        font-style: italic;
    }
</style>
</head>
<body>

<h2>Suivi des Appartements</h2>

<table id="appartTable">
    <thead>
        <tr>
            <th>Num Appart</th>
            <th>Couche 1</th>
            <th>Couche 2</th>
            <th>Termin√©</th>
            <th>Commentaire</th>
        </tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<script>
const batiments = [
    { nom: 'A', etages: 5 },
    { nom: 'B', etages: 6 },
    { nom: 'C', etages: 5 }
];

const tableBody = document.getElementById('tableBody');

// üîπ Charger les donn√©es sauvegard√©es depuis le localStorage
const savedData = JSON.parse(localStorage.getItem('appartData') || '{}');

// Fonction pour sauvegarder dans le localStorage
function saveToLocalStorage() {
    localStorage.setItem('appartData', JSON.stringify(savedData));
}

batiments.forEach(bat => {
    const trBat = document.createElement('tr');
    trBat.classList.add('batiment-header');
    trBat.innerHTML = `<td colspan="5">B√¢timent ${bat.nom}</td>`;
    tableBody.appendChild(trBat);

    for (let etage = 0; etage < bat.etages; etage++) {
        const trEtage = document.createElement('tr');
        trEtage.classList.add('etage-header');
        trEtage.innerHTML = `<td colspan="5">√âtage ${etage}</td>`;
        tableBody.appendChild(trEtage);

        for (let num = 1; num <= 9; num++) {
            const appartNum = `${bat.nom}${etage}${num}`;
            const data = savedData[appartNum] || {}; // üîπ Restaurer donn√©es si dispo

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${appartNum}</td>
                <td><input type="checkbox" class="couche1" ${data.couche1 ? 'checked' : ''}></td>
                <td><input type="checkbox" class="couche2" ${data.couche2 ? 'checked' : ''}></td>
                <td><input type="checkbox" class="termine" ${data.termine ? 'checked' : ''}></td>
                <td class="comment">
                    <div class="comment-container">
                        <input type="text" class="editable" placeholder="Ajouter un commentaire..." value="${data.comment || ''}">
                    </div>
                </td>
            `;
            tableBody.appendChild(tr);
        }
    }
});

// üîπ √âv√©nement : mise √† jour automatique du champ "Termin√©"
document.querySelector('#appartTable').addEventListener('change', (e) => {
    if (e.target.matches('.couche1, .couche2, .termine')) {
        const row = e.target.closest('tr');
        const appartNum = row.children[0].textContent;
        const couche1 = row.querySelector('.couche1').checked;
        const couche2 = row.querySelector('.couche2').checked;
        const termine = row.querySelector('.termine');

        // coche automatique du champ "Termin√©"
        if (e.target.classList.contains('couche1') || e.target.classList.contains('couche2')) {
            termine.checked = couche1 && couche2;
        }

        // üîπ Sauvegarde de l'√©tat
        savedData[appartNum] = {
            couche1,
            couche2,
            termine: termine.checked,
            comment: row.querySelector('.editable').value
        };
        saveToLocalStorage();
    }
});

// üîπ √âv√©nement : sauvegarder les commentaires en direct
document.querySelector('#appartTable').addEventListener('input', (e) => {
    if (e.target.matches('.editable')) {
        const row = e.target.closest('tr');
        const appartNum = row.children[0].textContent;
        if (!savedData[appartNum]) savedData[appartNum] = {};
        savedData[appartNum].comment = e.target.value;
        saveToLocalStorage();
    }
});
</script>

</body>
</html>
